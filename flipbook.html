<!-- Flipbook App v2.3 - Animation Stacking Bug Fix -->
<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Digital Flipbook v2.3</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400..900;1,400..900&family=Roboto:wght@300;400&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            background-color: #8B4513;
            background-image: url('https://www.transparenttextures.com/patterns/wood-pattern.png');
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
            color: #333;
        }

        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
            padding: 1rem;
        }
        
        .book {
            position: relative;
            width: 90vw;
            height: 31.8vw; 
            max-width: 1200px;
            max-height: 424px; 
            perspective: 2500px;
            user-select: none;
        }
        
        .paper {
            position: absolute;
            width: 50%;
            height: 100%;
            top: 0;
            left: 50%; 
            transform-style: preserve-3d;
            transform-origin: left center; 
            transition: transform 0.6s ease-in-out;
        }

        .paper.flipped {
            transform: rotateY(-180deg);
        }

        .front,
        .back {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            backface-visibility: hidden;
            background-color: #fdfaf3;
            border: 1px solid #e0dccc;
        }
        
        .front-content,
        .back-content {
            cursor: pointer;
        }

        .paper .front {
            border-radius: 0 10px 10px 0;
        }
        .paper .back {
            border-radius: 10px 0 0 10px;
            transform: rotateY(180deg);
        }

        .front-content,
        .back-content {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 0.5rem;
            box-sizing: border-box;
            text-align: center;
        }

        .page-text {
            font-size: 0.8rem;
            line-height: 1.4;
            color: #6d6d6d;
            margin-top: 0.5rem;
        }
        
        .placeholder-image {
            width: 95%;
            height: 85%;
            background-color: #e0dccc;
            border-radius: 8px;
            object-fit: cover;
            cursor: zoom-in;
        }

        .cover-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: inherit;
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- Buku -->
        <div class="book" id="book">
            <div id="p1" class="paper">
                <div class="front"><div class="front-content" style="padding:0;"><img src="img/depan.jpg" alt="Muka Depan" class="cover-image"></div></div>
                <div class="back"><div class="back-content"><img src="img/gambar_1.jpg" alt="Halaman 1" class="placeholder-image fullscreen-trigger"><p class="page-text">1</p></div></div>
            </div>
            <div id="p2" class="paper">
                <div class="front"><div class="front-content"><img src="img/gambar_2.jpg" alt="Halaman 2" class="placeholder-image fullscreen-trigger"><p class="page-text">2</p></div></div>
                <div class="back"><div class="back-content"><img src="img/gambar_3.jpg" alt="Halaman 3" class="placeholder-image fullscreen-trigger"><p class="page-text">3</p></div></div>
            </div>
            <div id="p3" class="paper">
                <div class="front"><div class="front-content"><img src="img/gambar_4.jpg" alt="Halaman 4" class="placeholder-image fullscreen-trigger"><p class="page-text">4</p></div></div>
                <div class="back"><div class="back-content"><img src="img/gambar_5.jpg" alt="Halaman 5" class="placeholder-image fullscreen-trigger"><p class="page-text">5</p></div></div>
            </div>
            <div id="p4" class="paper">
                <div class="front"><div class="front-content"><img src="img/gambar_6.jpg" alt="Halaman 6" class="placeholder-image fullscreen-trigger"><p class="page-text">6</p></div></div>
                <div class="back"><div class="back-content"><img src="img/gambar_7.jpg" alt="Halaman 7" class="placeholder-image fullscreen-trigger"><p class="page-text">7</p></div></div>
            </div>
            <div id="p5" class="paper">
                <div class="front"><div class="front-content"><img src="img/gambar_8.jpg" alt="Halaman 8" class="placeholder-image fullscreen-trigger"><p class="page-text">8</p></div></div>
                <div class="back"><div class="back-content"><img src="img/gambar_9.jpg" alt="Halaman 9" class="placeholder-image fullscreen-trigger"><p class="page-text">9</p></div></div>
            </div>
            <div id="p6" class="paper">
                <div class="front"><div class="front-content"><img src="img/gambar_10.jpg" alt="Halaman 10" class="placeholder-image fullscreen-trigger"><p class="page-text">10</p></div></div>
                <div class="back"><div class="back-content"><img src="img/gambar_11.jpg" alt="Halaman 11" class="placeholder-image fullscreen-trigger"><p class="page-text">11</p></div></div>
            </div>
            <div id="p7" class="paper">
                <div class="front"><div class="front-content"><img src="img/gambar_12.jpg" alt="Halaman 12" class="placeholder-image fullscreen-trigger"><p class="page-text">12</p></div></div>
                <div class="back"><div class="back-content"><img src="img/gambar_13.jpg" alt="Halaman 13" class="placeholder-image fullscreen-trigger"><p class="page-text">13</p></div></div>
            </div>
            <div id="p8" class="paper">
                <div class="front"><div class="front-content"><img src="img/gambar_14.jpg" alt="Halaman 14" class="placeholder-image fullscreen-trigger"><p class="page-text">14</p></div></div>
                <div class="back"><div class="back-content" style="padding:0;"><img src="img/belakang.jpg" alt="Muka Belakang" class="cover-image"></div></div>
            </div>
        </div>

        <!-- Butang Navigasi -->
        <div class="flex items-center space-x-4">
            <button id="prev-btn" class="px-4 py-2 bg-white/80 text-gray-800 font-semibold rounded-lg shadow-lg hover:bg-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition-transform transform hover:scale-105">
                Sebelumnya
            </button>
            <button id="home-btn" class="p-3 bg-white/80 text-gray-800 font-semibold rounded-full shadow-lg hover:bg-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition-transform transform hover:scale-105">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
            </button>
            <button id="next-btn" class="px-4 py-2 bg-white/80 text-gray-800 font-semibold rounded-lg shadow-lg hover:bg-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400 transition-transform transform hover:scale-105">
                Seterusnya
            </button>
        </div>
    </div>
    
    <div id="fullscreen-overlay" class="hidden fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4 cursor-pointer">
        <img id="fullscreen-image" src="" alt="Fullscreen Image" class="max-w-full max-h-full object-contain">
        <button id="close-fullscreen" class="absolute top-5 right-8 text-white text-5xl font-bold">&times;</button>
    </div>


    <script>
        const book = document.getElementById('book');
        const prevBtn = document.getElementById("prev-btn");
        const nextBtn = document.getElementById("next-btn");
        const homeBtn = document.getElementById("home-btn");
        const papers = Array.from(document.querySelectorAll(".paper"));
        
        const fullscreenOverlay = document.getElementById('fullscreen-overlay');
        const fullscreenImage = document.getElementById('fullscreen-image');
        const closeFullscreenBtn = document.getElementById('close-fullscreen');

        const numPapers = papers.length;
        let currentLocation = 0;
        let isFlipping = false; // Add a lock to prevent rapid clicks

        // --- Event Listeners ---
        nextBtn.addEventListener("click", goNextPage);
        prevBtn.addEventListener("click", goPrevPage);
        homeBtn.addEventListener("click", goToFirstPage);
        book.addEventListener('click', handleBookClick);
        
        closeFullscreenBtn.addEventListener('click', closeFullscreenModal);
        fullscreenOverlay.addEventListener('click', (e) => {
            if (e.target === fullscreenOverlay) {
                closeFullscreenModal();
            }
        });
        
        // --- Initial Setup ---
        goToFirstPage();


        // --- FUNGSI NAVIGASI ---
        function goNextPage() {
            if (isFlipping || currentLocation >= numPapers) return;
            isFlipping = true;

            const pageToFlip = papers[currentLocation];
            
            // FIX: Bring page to front for the animation duration
            pageToFlip.style.zIndex = numPapers + 1;
            pageToFlip.classList.add("flipped");
            
            currentLocation++;

            // After animation, set its final z-index in the left stack
            setTimeout(() => {
                pageToFlip.style.zIndex = currentLocation;
                isFlipping = false;
            }, 600); // Must match CSS transition duration
        }

        function goPrevPage() {
            if (isFlipping || currentLocation <= 0) return;
            isFlipping = true;

            currentLocation--;
            const pageToUnflip = papers[currentLocation];

            // FIX: Bring page to front for the animation duration
            pageToUnflip.style.zIndex = numPapers + 1;
            pageToUnflip.classList.remove("flipped");

            // After animation, reset z-index for ALL pages to maintain correct stack order
            setTimeout(() => {
                papers.forEach((paper, index) => {
                    if (index < currentLocation) {
                        paper.style.zIndex = index + 1;
                    } else {
                        paper.style.zIndex = numPapers - index;
                    }
                });
                isFlipping = false;
            }, 600);
        }

        function goToFirstPage() {
            if (isFlipping) return;
            currentLocation = 0;
            papers.forEach((paper, index) => {
                paper.classList.remove("flipped");
                paper.style.zIndex = numPapers - index;
            });
        }

        // --- FUNGSI INTERAKTIF ---
        function handleBookClick(e) {
            if (isFlipping) return;

            if (e.target.classList.contains('fullscreen-trigger')) {
                openFullscreenModal(e.target.src);
                return;
            }

            const bookRect = book.getBoundingClientRect();
            const clickX = e.clientX - bookRect.left;

            if (clickX < bookRect.width / 2) {
                goPrevPage();
            } else {
                goNextPage();
            }
        }
        
        function openFullscreenModal(src) {
            fullscreenImage.src = src;
            fullscreenOverlay.classList.remove('hidden');
        }

        function closeFullscreenModal() {
            fullscreenOverlay.classList.add('hidden');
            fullscreenImage.src = '';
        }

    </script>

</body>
</html>

